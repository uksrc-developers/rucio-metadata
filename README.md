# rucio-metadata

This repo contains python scripts designed to get the required metadata for data ingestion into UKSRC via Rucio.

At a minimum, each of these scripts will generate a json file containing the following metadata:

- namespace
- filename
- lifetime

Please see [this confluence page](https://confluence.skatelescope.org/x/DQ0AEw) for more details on the required metadata.


## Python dependencies

The scripts in this directory are written in python and have the following dependencies

- astropy
- numpy


## FITS files

`get_fits_metadata.py` gets relevant header metadata from FITS files.  It accepts a set of command line arguments as inputs including a path to at least one FITS file.  The full list of command line arguments and their descriptions can be seen via the `-h` or `--help` flags, i.e.

```
python get_fits_metadata.py -h
```

Metadata for multiple FITS files can be generated by passing more than one file path as positional arguments.  A metadata file will be created for each input file.  For example, to create metadata files for two FITS files, `/path/to/file1.fits` and `/path/to/file2.fits`, with a lifetime of 1 week (604800 seconds) belonging to the 'teal' namespace, you would execute

```
python get_fits_metadata.py --namespace teal --lifetime 604800 /path/to/file1.fits /path/to/file2.fits
```

### Data compatibility

This script has been tested on FITS files containing 2D image and HEALPix data.  It has been designed to work on data of arbitrary dimension as long as each dimension has a relevant 'CTYPE' header keyword.

If the file contains HEALPix data, this script only looks for the following header keywords:

- NSIDE
- ORDERING
- NPIX
- FIRSTPIX
- LASTPIX

If the file contains non-HEALPix data, which is assumed to be N-dimensional image data, this script examines all the 'CTYPEn' keywords looking for either 'GLON' and 'GLAT' or 'RA--' and 'DEC-'.  If galactic reference coordinates are found, these coordinates are converted to (RA, Dec).  In this case, this script only looks for the following header keywords:

- NAXIS
- CTYPEn
- CRVALn

Additionally, for all types of FITS data, this script also looks for the following header keywords:

- NAXIS1
- NAXIS2
- OBJECT
- TELESCOP

### Jira tickets

- [TEAL-941](https://jira.skatelescope.org/browse/TEAL-941)
